<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="in.koala.mapper.KeywordMapper">

    <select id = "myKeywordList" parameterType="java.lang.Long" resultType="in.koala.domain.Keyword">
        SELECT k.id, k.name as keyword, k.site, uk.is_important as isImportant
        FROM keyword as k
            INNER JOIN user_keyword as uk ON uk.keyword_id = k.id
        WHERE uk.user_id = #{userId}
    </select>

    <select id="checkDuplicateUsersKeyword" parameterType="in.koala.domain.Keyword" resultType="java.lang.Long">
        SELECT id
        FROM keyword
        WHERE user_id = #{userId} AND name = #{name}
    </select>

    <insert id="insertUsersKeyword" parameterType="in.koala.domain.Keyword">
        INSERT INTO keyword (user_id, name, is_important, alarm_mode, alarm_cycle, created_at)
        VALUES (#{userId}, #{name}, #{isImportant}, #{alarmMode}, #{alarmCycle}, #{createdAt})
        <selectKey keyProperty="id" resultType="Long" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <insert id="insertUsersKeywordSite" parameterType="java.util.Map">
        INSERT INTO keyword_site(keyword_id, site_name, created_at)
        VALUES
        <foreach item="site" separator=" , " collection="siteList">
            (
            #{keywordId},
            #{site, jdbcType=VARCHAR},
            #{createdAt}
            )
        </foreach>;
    </insert>

    <update id="deleteKeyword" parameterType="java.util.Map">
        UPDATE keyword
        SET is_deleted = 1
        WHERE user_id = #{userId}
            AND name = #{name};

        UPDATE keyword_site
        SET is_deleted = 1
        WHERE keyword_id = (
                SELECT id
                FROM keyword
                WHERE user_id = #{userId}
                  AND name = #{name}
            );
    </update>

    <update id="modifyKeyword" parameterType="java.util.Map">

    </update>

</mapper>